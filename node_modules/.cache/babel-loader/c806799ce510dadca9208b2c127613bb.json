{"ast":null,"code":"var _jsxFileName = \"/Users/Tuan/Desktop/FPT/Mock/Nike-ReactTs-CLient/src/components/auth/authentication/unAuthenticatedGuard/UnAuthenticatedGuard.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport { Redirect } from \"react-router\";\nimport { useAppSelector, useAppDispatch, userFetchSuccess, userFetchError, logoutSuccess } from \"../../../../services/store\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { authByToken } from \"../../../../services/apis\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst UnAuthenticatedGuard = props => {\n  _s();\n\n  var _location$state;\n\n  const {\n    children\n  } = props;\n  const dispatch = useAppDispatch();\n  const {\n    isAuth,\n    dataUser\n  } = useAppSelector(state => state.authReducer);\n  const history = useHistory();\n  const location = useLocation();\n  const referrer = location === null || location === void 0 ? void 0 : (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.referrer;\n  useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      authByToken().then(res => {\n        dispatch(userFetchSuccess(res.data));\n        setTimeout(function () {\n          dispatch(logoutSuccess());\n          history.push('/login');\n        }, new Date(res.data.expired).getTime() - new Date().getTime());\n      }).catch(err => {\n        if (localStorage.getItem(\"token\")) {\n          localStorage.removeItem(\"token\");\n        }\n\n        dispatch(userFetchError(err.response.data.message));\n      });\n    }\n  }, []);\n\n  const redirect = () => {\n    if (dataUser) {\n      const {\n        rules\n      } = dataUser;\n\n      for (let rule of rules) {\n        if (rule.includes(\"admin\")) return \"/admin\";\n      }\n\n      return \"/\";\n    }\n\n    return \"/\";\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: isAuth ? /*#__PURE__*/_jsxDEV(Redirect, {\n      to: referrer ? referrer : redirect()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 17\n    }, this) : children\n  }, void 0, false);\n};\n\n_s(UnAuthenticatedGuard, \"KDh4aLZX0W0VFjWRA+pdfixAKrM=\", false, function () {\n  return [useAppDispatch, useAppSelector, useHistory, useLocation];\n});\n\n_c = UnAuthenticatedGuard;\nexport default UnAuthenticatedGuard;\n\nvar _c;\n\n$RefreshReg$(_c, \"UnAuthenticatedGuard\");","map":{"version":3,"sources":["/Users/Tuan/Desktop/FPT/Mock/Nike-ReactTs-CLient/src/components/auth/authentication/unAuthenticatedGuard/UnAuthenticatedGuard.tsx"],"names":["useEffect","Redirect","useAppSelector","useAppDispatch","userFetchSuccess","userFetchError","logoutSuccess","useHistory","useLocation","authByToken","UnAuthenticatedGuard","props","children","dispatch","isAuth","dataUser","state","authReducer","history","location","referrer","localStorage","getItem","then","res","data","setTimeout","push","Date","expired","getTime","catch","err","removeItem","response","message","redirect","rules","rule","includes"],"mappings":";;;AAAA,SAAaA,SAAb,QAA8B,OAA9B;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,SACEC,cADF,EAEEC,cAFF,EAGEC,gBAHF,EAIEC,cAJF,EAKEC,aALF,QAMO,4BANP;AAOA,SAASC,UAAT,EAAqBC,WAArB,QAAwC,kBAAxC;AACA,SAASC,WAAT,QAA4B,2BAA5B;;;;AAIA,MAAMC,oBAA+B,GAAIC,KAAD,IAAW;AAAA;;AAAA;;AACjD,QAAM;AAAEC,IAAAA;AAAF,MAAeD,KAArB;AACA,QAAME,QAAQ,GAAGV,cAAc,EAA/B;AACA,QAAM;AAAEW,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAuBb,cAAc,CAAEc,KAAD,IAAWA,KAAK,CAACC,WAAlB,CAA3C;AACA,QAAMC,OAAO,GAAGX,UAAU,EAA1B;AACA,QAAMY,QAAa,GAAGX,WAAW,EAAjC;AACA,QAAMY,QAAgB,GAAGD,QAAH,aAAGA,QAAH,0CAAGA,QAAQ,CAAEH,KAAb,oDAAG,gBAAiBI,QAA1C;AAEApB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIqB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AACjCb,MAAAA,WAAW,GACRc,IADH,CACSC,GAAD,IAAS;AACbX,QAAAA,QAAQ,CAACT,gBAAgB,CAACoB,GAAG,CAACC,IAAL,CAAjB,CAAR;AACAC,QAAAA,UAAU,CAAC,YAAY;AACrBb,UAAAA,QAAQ,CAACP,aAAa,EAAd,CAAR;AACAY,UAAAA,OAAO,CAACS,IAAR,CAAa,QAAb;AACD,SAHS,EAGR,IAAIC,IAAJ,CAASJ,GAAG,CAACC,IAAJ,CAASI,OAAlB,EAA2BC,OAA3B,KAAuC,IAAIF,IAAJ,GAAWE,OAAX,EAH/B,CAAV;AAID,OAPH,EAQGC,KARH,CAQUC,GAAD,IAAS;AACd,YAAIX,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AACjCD,UAAAA,YAAY,CAACY,UAAb,CAAwB,OAAxB;AACD;;AACDpB,QAAAA,QAAQ,CAACR,cAAc,CAAC2B,GAAG,CAACE,QAAJ,CAAaT,IAAb,CAAkBU,OAAnB,CAAf,CAAR;AAAoD,OAZxD;AAaD;AACF,GAhBQ,EAgBN,EAhBM,CAAT;;AAkBA,QAAMC,QAAQ,GAAG,MAAM;AACrB,QAAIrB,QAAJ,EAAc;AACZ,YAAM;AAAEsB,QAAAA;AAAF,UAAYtB,QAAlB;;AACA,WAAK,IAAIuB,IAAT,IAAiBD,KAAjB,EAAwB;AACtB,YAAIC,IAAI,CAACC,QAAL,CAAc,OAAd,CAAJ,EAA4B,OAAO,QAAP;AAC7B;;AACD,aAAO,GAAP;AACD;;AACD,WAAO,GAAP;AACD,GATD;;AAUA,sBACE;AAAA,cACGzB,MAAM,gBAAG,QAAC,QAAD;AAAU,MAAA,EAAE,EAAEM,QAAQ,GAAGA,QAAH,GAAcgB,QAAQ;AAA5C;AAAA;AAAA;AAAA;AAAA,YAAH,GAAwDxB;AADjE,mBADF;AAKD,CAzCD;;GAAMF,oB;UAEaP,c,EACYD,c,EACbK,U,EACMC,W;;;KALlBE,oB;AA2CN,eAAeA,oBAAf","sourcesContent":["import { FC, useEffect } from \"react\";\nimport { Redirect } from \"react-router\";\nimport {\n  useAppSelector,\n  useAppDispatch,\n  userFetchSuccess,\n  userFetchError,\n  logoutSuccess\n} from \"../../../../services/store\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { authByToken } from \"../../../../services/apis\";\n\ninterface Props {}\n\nconst UnAuthenticatedGuard: FC<Props> = (props) => {\n  const { children } = props;\n  const dispatch = useAppDispatch();\n  const { isAuth, dataUser } = useAppSelector((state) => state.authReducer);\n  const history = useHistory() as any\n  const location: any = useLocation();\n  const referrer: string = location?.state?.referrer;\n\n  useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      authByToken()\n        .then((res) => {\n          dispatch(userFetchSuccess(res.data));\n          setTimeout(function () {\n            dispatch(logoutSuccess())\n            history.push('/login')\n          },new Date(res.data.expired).getTime() - new Date().getTime())\n        })\n        .catch((err) => {\n          if( localStorage.getItem(\"token\")) {\n            localStorage.removeItem(\"token\") \n          }\n          dispatch(userFetchError(err.response.data.message))});\n    }\n  }, []);\n\n  const redirect = () => {\n    if (dataUser) {\n      const { rules } = dataUser;\n      for (let rule of rules) {\n        if (rule.includes(\"admin\")) return \"/admin\";\n      }\n      return \"/\";\n    }\n    return \"/\";\n  };\n  return (\n    <>\n      {isAuth ? <Redirect to={referrer ? referrer : redirect()} /> : children}\n    </>\n  );\n};\n\nexport default UnAuthenticatedGuard;\n"]},"metadata":{},"sourceType":"module"}