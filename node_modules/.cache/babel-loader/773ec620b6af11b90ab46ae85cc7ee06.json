{"ast":null,"code":"var _jsxFileName = \"/Users/Tuan/Desktop/FPT/Mock/Nike-ReactTs-CLient/src/components/auth/authentication/authenticatedGuard/AuthenticatedGuard.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport { Redirect } from \"react-router\";\nimport { useAppSelector, useAppDispatch, userFetchSuccess, userFetchError, logoutSuccess } from \"../../../../services/store\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { authByToken } from \"../../../../services/apis\";\nimport { hasPermission } from \"../../../../services/functions\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst AuthenticatedGuard = props => {\n  _s();\n\n  const {\n    ifInaccessibleRedirectTo,\n    children,\n    routeRules\n  } = props;\n  const dispatch = useAppDispatch();\n  const {\n    isAuth,\n    dataUser\n  } = useAppSelector(state => state.authReducer);\n  const location = useLocation();\n  const history = useHistory();\n  useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      authByToken().then(res => {\n        dispatch(userFetchSuccess(res.data));\n        console.log(new Date(res.data.expired).getTime() - new Date().getTime());\n        setTimeout(function () {\n          dispatch(logoutSuccess());\n          history.push('/login');\n        }, new Date(res.data.expired).getTime() - new Date().getTime());\n      }).catch(err => {\n        if (localStorage.getItem(\"token\")) {\n          localStorage.removeItem(\"token\");\n        }\n\n        dispatch(userFetchError(err.response.data.message));\n      });\n    }\n  }, []);\n\n  const checkAuthorization = () => {\n    return hasPermission(routeRules ? routeRules : [], dataUser ? dataUser === null || dataUser === void 0 ? void 0 : dataUser.rules : []);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: isAuth ? checkAuthorization() ? children : /*#__PURE__*/_jsxDEV(\"h4\", {\n      className: \"p-4 text-decoration-underline text-danger\",\n      children: \"Access Denied\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 11\n    }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n      to: {\n        pathname: ifInaccessibleRedirectTo ? ifInaccessibleRedirectTo : \"/login\",\n        state: {\n          referrer: location === null || location === void 0 ? void 0 : location.pathname\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(AuthenticatedGuard, \"Q0ntE8eYWOe0M8O8HkiTPdqUmug=\", false, function () {\n  return [useAppDispatch, useAppSelector, useLocation, useHistory];\n});\n\n_c = AuthenticatedGuard;\nexport default AuthenticatedGuard;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthenticatedGuard\");","map":{"version":3,"sources":["/Users/Tuan/Desktop/FPT/Mock/Nike-ReactTs-CLient/src/components/auth/authentication/authenticatedGuard/AuthenticatedGuard.tsx"],"names":["useEffect","Redirect","useAppSelector","useAppDispatch","userFetchSuccess","userFetchError","logoutSuccess","useHistory","useLocation","authByToken","hasPermission","AuthenticatedGuard","props","ifInaccessibleRedirectTo","children","routeRules","dispatch","isAuth","dataUser","state","authReducer","location","history","localStorage","getItem","then","res","data","console","log","Date","expired","getTime","setTimeout","push","catch","err","removeItem","response","message","checkAuthorization","rules","pathname","referrer"],"mappings":";;;AAAA,SAAaA,SAAb,QAA8B,OAA9B;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,SACEC,cADF,EAEEC,cAFF,EAGEC,gBAHF,EAIEC,cAJF,EAKEC,aALF,QAMO,4BANP;AAOA,SAASC,UAAT,EAAqBC,WAArB,QAAwC,kBAAxC;AACA,SAASC,WAAT,QAA4B,2BAA5B;AACA,SAASC,aAAT,QAA8B,gCAA9B;;;;AAOA,MAAMC,kBAA6B,GAAIC,KAAD,IAAW;AAAA;;AAE/C,QAAM;AAAEC,IAAAA,wBAAF;AAA4BC,IAAAA,QAA5B;AAAsCC,IAAAA;AAAtC,MAAqDH,KAA3D;AACA,QAAMI,QAAQ,GAAGb,cAAc,EAA/B;AACA,QAAM;AAAEc,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAuBhB,cAAc,CAAEiB,KAAD,IAAWA,KAAK,CAACC,WAAlB,CAA3C;AACA,QAAMC,QAAa,GAAGb,WAAW,EAAjC;AACA,QAAMc,OAAO,GAAGf,UAAU,EAA1B;AAEAP,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIuB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AACjCf,MAAAA,WAAW,GACRgB,IADH,CACSC,GAAD,IAAc;AAClBV,QAAAA,QAAQ,CAACZ,gBAAgB,CAACsB,GAAG,CAACC,IAAL,CAAjB,CAAR;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAIC,IAAJ,CAASJ,GAAG,CAACC,IAAJ,CAASI,OAAlB,EAA2BC,OAA3B,KAAuC,IAAIF,IAAJ,GAAWE,OAAX,EAAnD;AAEAC,QAAAA,UAAU,CAAC,YAAY;AACrBjB,UAAAA,QAAQ,CAACV,aAAa,EAAd,CAAR;AACAgB,UAAAA,OAAO,CAACY,IAAR,CAAa,QAAb;AAED,SAJS,EAIR,IAAIJ,IAAJ,CAASJ,GAAG,CAACC,IAAJ,CAASI,OAAlB,EAA2BC,OAA3B,KAAuC,IAAIF,IAAJ,GAAWE,OAAX,EAJ/B,CAAV;AAKD,OAVH,EAWGG,KAXH,CAWUC,GAAD,IAAS;AACd,YAAIb,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AACjCD,UAAAA,YAAY,CAACc,UAAb,CAAwB,OAAxB;AACD;;AACDrB,QAAAA,QAAQ,CAACX,cAAc,CAAC+B,GAAG,CAACE,QAAJ,CAAaX,IAAb,CAAkBY,OAAnB,CAAf,CAAR;AAAoD,OAfxD;AAgBD;AACF,GAnBQ,EAmBN,EAnBM,CAAT;;AAqBA,QAAMC,kBAAkB,GAAG,MAAM;AAC/B,WAAO9B,aAAa,CAClBK,UAAU,GAAGA,UAAH,GAAgB,EADR,EAElBG,QAAQ,GAAGA,QAAH,aAAGA,QAAH,uBAAGA,QAAQ,CAAEuB,KAAb,GAAqB,EAFX,CAApB;AAID,GALD;;AAOA,sBACE;AAAA,cACGxB,MAAM,GACLuB,kBAAkB,KAChB1B,QADgB,gBAGhB;AAAI,MAAA,SAAS,EAAC,2CAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAJG,gBASL,QAAC,QAAD;AACE,MAAA,EAAE,EAAE;AACF4B,QAAAA,QAAQ,EAAE7B,wBAAwB,GAC9BA,wBAD8B,GAE9B,QAHF;AAIFM,QAAAA,KAAK,EAAE;AAAEwB,UAAAA,QAAQ,EAAEtB,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEqB;AAAtB;AAJL;AADN;AAAA;AAAA;AAAA;AAAA;AAVJ,mBADF;AAsBD,CA1DD;;GAAM/B,kB;UAGaR,c,EACYD,c,EACPM,W,EACND,U;;;KANZI,kB;AA4DN,eAAeA,kBAAf","sourcesContent":["import { FC, useEffect } from \"react\";\nimport { Redirect } from \"react-router\";\nimport {\n  useAppSelector,\n  useAppDispatch,\n  userFetchSuccess,\n  userFetchError,\n  logoutSuccess\n} from \"../../../../services/store\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { authByToken } from \"../../../../services/apis\";\nimport { hasPermission } from \"../../../../services/functions\";\n\ninterface Props {\n  ifInaccessibleRedirectTo?: string;\n  routeRules?: string[];\n}\n\nconst AuthenticatedGuard: FC<Props> = (props) => {\n\n  const { ifInaccessibleRedirectTo, children, routeRules } = props;\n  const dispatch = useAppDispatch();\n  const { isAuth, dataUser } = useAppSelector((state) => state.authReducer);\n  const location: any = useLocation();\n  const history = useHistory() as any\n\n  useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      authByToken()\n        .then((res: any) => {\n          dispatch(userFetchSuccess(res.data));\n          console.log(new Date(res.data.expired).getTime() - new Date().getTime())\n\n          setTimeout(function () {\n            dispatch(logoutSuccess())\n            history.push('/login')\n\n          },new Date(res.data.expired).getTime() - new Date().getTime())\n        })\n        .catch((err) => {\n          if( localStorage.getItem(\"token\")) {\n            localStorage.removeItem(\"token\") \n          }\n          dispatch(userFetchError(err.response.data.message))});\n    }\n  }, []);\n\n  const checkAuthorization = () => {\n    return hasPermission(\n      routeRules ? routeRules : [],\n      dataUser ? dataUser?.rules : []\n    );\n  };\n\n  return (\n    <>\n      {isAuth ? (\n        checkAuthorization() ? (\n          children\n        ) : (\n          <h4 className=\"p-4 text-decoration-underline text-danger\">\n            Access Denied\n          </h4>\n        )\n      ) : (\n        <Redirect\n          to={{\n            pathname: ifInaccessibleRedirectTo\n              ? ifInaccessibleRedirectTo\n              : \"/login\",\n            state: { referrer: location?.pathname },\n          }}\n        />\n      )}\n    </>\n  );\n};\n\nexport default AuthenticatedGuard;\n"]},"metadata":{},"sourceType":"module"}